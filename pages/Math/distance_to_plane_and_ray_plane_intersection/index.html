<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Distance to Plane and Ray Plane Intersection</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous"/>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <header>
   <h1> <a href="../../../">Ian Stranathan </a></h1>
    <p> Noodling around: Graphics | Game Development | Physics | Math <p>
    <nav>
      <ul>
	<li><a href="../../Misc/About/"><i class="fa-regular fa-address-card"></i></a></li>
	<li><a href="mailto:ian@wabisoft.io"><i class="fa fa-envelope" aria-hidden="true"></i></a></li>
	<li><a href="https://github.com/stranathan"><i class="fa-brands fa-github"></i></a></li>
      </ul>
    </nav>
  </header><div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org8c4625d">Motivation</a></li>
<li><a href="#org3867280">Problem Set Up</a></li>
<li><a href="#org046d61c">Distance to a plane</a>
<ul>
<li><a href="#org0795b9b">Via projection of point onto normal:</a></li>
<li><a href="#org9ab9f97">Via ray intersection</a></li>
</ul>
</li>
<li><a href="#org202ff36">Equation of a plane</a></li>
<li><a href="#org32ecf65">Ray Plane Intersection</a></li>
<li><a href="#org3a9bf3e">Wrapping Up</a>
<ul>
<li><a href="#org9ccdfcc">Misc.</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org8c4625d" class="outline-2">
<h2 id="org8c4625d">Motivation</h2>
<div class="outline-text-2" id="text-org8c4625d">
<hr />
<p>
<i>While watching <a href="https://www.youtube.com/watch?v=pq7dV4sR7lg">Casey Muratori write a raytracer</a> recently, I noticed he characterized the equation of a plane equation in a weird way, so I decided to write out a quick derivation.</i>
</p>
</div>
</div>

<div id="outline-container-org3867280" class="outline-2">
<h2 id="org3867280">Problem Set Up</h2>
<div class="outline-text-2" id="text-org3867280">
<hr />
<p>
What seemed weird to me was his expression for a plane:  \(N^T \cdot P + d = 0\)
Where \(N^T\) is a normal to the plane, <b>P</b> is a point on the plane and <b>d</b> is the distance to the plane. The operator is the scalar product.
</p>

<p>
Non-standard notation aside, this just isn't an equation to generate a plane.
</p>


<div id="orgb56f943" class="figure">
<p><img src="../../../img/Math/distance_to_plane_and_ray_plane_intersection/caseySetup1.png" alt="caseySetup1.png" />
</p>
<p><span class="figure-number">Figure 1: </span>Arbitrary plane with a point on the plane</p>
</div>


<div id="org7a85741" class="figure">
<p><img src="../../../img/Math/distance_to_plane_and_ray_plane_intersection/caseySetup2.png" alt="caseySetup2.png" />
</p>
<p><span class="figure-number">Figure 2: </span>\(\vec{N} \cdot \vec{P}\) is the distance from the origin to the plane</p>
</div>

<p>
Let's make this explicit by showing the distance to a plane from any arbitrary point (not just the origin) using two different means
</p>
</div>
</div>

<div id="outline-container-org046d61c" class="outline-2">
<h2 id="org046d61c">Distance to a plane</h2>
<div class="outline-text-2" id="text-org046d61c">
<hr />
</div>

<div id="outline-container-org0795b9b" class="outline-3">
<h3 id="org0795b9b">Via projection of point onto normal:</h3>
<div class="outline-text-3" id="text-org0795b9b">
<hr />

<p>
Repeating our drawing from above for an arbitrary point &#x2013; feel free to skip this one, just keeping things tidy.
</p>


<div id="org0b08df6" class="figure">
<p><img src="../../../img/Math/distance_to_plane_and_ray_plane_intersection/diagramOneProj.png" alt="diagramOneProj.png" />
</p>
<p><span class="figure-number">Figure 3: </span>The projection length of the relative position vector between an arbitrary position \(\vec{Q}\) and a point on the plane \(\vec{P}\) with the plane normal \(\vec{n}\)</p>
</div>


<div id="org5e4a970" class="figure">
<p><img src="../../../img/Math/distance_to_plane_and_ray_plane_intersection/diagramTwoProj.png" alt="diagramTwoProj.png" />
</p>
<p><span class="figure-number">Figure 4: </span>Again, same setup from a different perspective, still slowing dying from boredom</p>
</div>


<p>
The dot product of the relative position vector and the normal:
</p>

<p>
\(\vec{QP} = \vec{Q} - \vec{P}\) 
</p>

<p>
By definition of the dot product
</p>

<p>
\[\vec{QP} \cdot \vec{n} = \lvert \lvert \vec{QP} \rvert \rvert \lvert \lvert \vec{n} \rvert \rvert \cos{\theta}\]
</p>


<p>
\[\implies \lvert \lvert \vec{QP} \rvert \rvert \cos{\theta} = \frac{\vec{QP} \cdot \vec{n}}{ \lvert \lvert \vec{n} \rvert \rvert}\]
</p>

<p>
In the case that the normal is unit length, this simplifies to our first result
</p>
</div>
</div>

<div id="outline-container-org9ab9f97" class="outline-3">
<h3 id="org9ab9f97">Via ray intersection</h3>
<div class="outline-text-3" id="text-org9ab9f97">
<hr />

<p>
It's always encouraging to see the same result in multiple ways:
</p>


<div id="org7b19e24" class="figure">
<p><img src="../../../img/Math/distance_to_plane_and_ray_plane_intersection/diagramOneRay.png" alt="diagramOneRay.png" />
</p>
<p><span class="figure-number">Figure 5: </span>The first diagram with the ray intersection point \(\vec{P}^\prime\)</p>
</div>



<div id="orgba9c209" class="figure">
<p><img src="../../../img/Math/distance_to_plane_and_ray_plane_intersection/diagramTwoRay.png" alt="diagramTwoRay.png" />
</p>
<p><span class="figure-number">Figure 6: </span>The same as above but from a different perspective</p>
</div>


<p>
The vector equation of a ray (really a line segment &#x2013; we just discard negative scaling values ℓ for the ray):
\(\vec{ray} = \vec{r_0} + ℓ \vec{rd}\)
</p>

<p>
Where \(\vec{rd}\) is a unit vector in the ray direction.
</p>

<p>
In the case of just looking for the distance to the plane, the ray direction is \(\pm\) the unit vector of whatever the normal vector happens
to be depending on what side of the plane the ray origin is on; where the ray origin is our arbitrary point \(Q\)
</p>

<p>
\(\vec{rd} = \frac{\vec{n}}{\lvert \lvert \vec{n} \rvert \rvert}\)  ;  \(\vec{r_0} = \vec{Q}\)
</p>

<p>
Substituting this into the plane equation:
</p>

<p>
\(\left( \vec{Q} - ℓ \frac{\vec{n}}{\lvert \lvert \vec{n} \rvert \rvert} - \vec{P} \right) \cdot \vec{n} = 0\)
</p>

<p>
Solving for ℓ:
(Rearranging and using properties of the dot product (distributive &amp; \(\vec{a} \cdot \vec{a} = {\lvert \lvert \vec{a} \rvert \rvert}^2\)))
</p>

<p>
\(\left(\vec{Q} - \vec{P} \right) \cdot \vec{n} - ℓ \frac{\vec{n}}{\lvert \lvert \vec{n} \rvert \rvert} \cdot \vec{n} = 0\)
</p>

<p>
\(\left(\vec{Q} - \vec{P} \right) \cdot \vec{n} - ℓ \frac{{\lvert \lvert \vec{n} \rvert \rvert}^2}{\lvert \lvert \vec{n} \rvert \rvert} = 0\)
</p>

<p>
\(\vec{QP} \cdot \vec{n} - ℓ \lvert \lvert \vec{n} \rvert \rvert = 0\)
</p>

<p>
\(ℓ = \frac{\vec{QP} \cdot \vec{n}}{\lvert \lvert \vec{n} \rvert \rvert}\)
</p>

<p>
And again, in the case that the normal is unit length, this simplifies to our first result.
</p>
</div>
</div>
</div>

<div id="outline-container-org202ff36" class="outline-2">
<h2 id="org202ff36">Equation of a plane</h2>
<div class="outline-text-2" id="text-org202ff36">
<hr />
<p>
Now that we've gorily (most might say unnecessarily) shown that the first expression \(\hat{n} \cdot \vec{P} + d = 0\) is indeed the distance from the origin to the plane, we can now show that the second expression is an accidental sleight of hand by deriving the equation of a plane.
</p>

<p>
From <a href="https://en.wikipedia.org/wiki/Plane_(geometry)">*wikipedia</a>*
</p>
<blockquote>
<p>
In a manner analogous to the way lines in a two-dimensional space are described using a point-slope form for their equations,
planes in a three dimensional space have a natural description using a point in the plane and a vector orthogonal to it (the normal vector) to indicate its "inclination".
</p>
</blockquote>

<p>
<b>Some visual intuition</b>:
</p>


<div id="org7ca56a1" class="figure">
<p><img src="../../../img/Math/distance_to_plane_and_ray_plane_intersection/equationIntuition.png" alt="equationIntuition.png" />
</p>
<p><span class="figure-number">Figure 7: </span>The dot product of a relative position vector and a normal must be zero to be on a plane</p>
</div>

<p>
A plane is defined for all \(\vec{P^{\prime}}\) if \(\left( \vec{P^{\prime}} - \vec{P} \right) \cdot \vec{n} = 0\), i.e. their dot product is zero (they're orthogonal to each other)
</p>

<p>
We can easily recover the more familiar implicit form (\(Ax + By + Cz = d\)) if we write out the expression in scalar form:
</p>

<p>
Some chosen inclination (a normal to the plane)
</p>

<p>
\(\vec{n} = \left( A, B, C \right)\)
And some chosen point on the plane
</p>

<p>
\(\vec{P} = \left( a, b, c \right)\)
And a variable point \(\vec{P^{\prime}}\)
</p>

<p>
\(\vec{P^{\prime}} = \left( x, y, z \right)\)
</p>

<p>
\(\implies \vec{P^{\prime}} - \vec{P} = \left(x - a, y - b, z - c \right)\)
</p>

<p>
And our plane is then: \(\left( \vec{P^{\prime}} - \vec{P} \right) \cdot \vec{n} = 0 = \left(x - a, y - b, z - c \right) \cdot \left( A, B, C \right)\)
</p>

<p>
Expanding the dot product:
\(\left(x - a, y - b, z - c \right) \cdot \left( A, B, C \right) = A\left(x - a \right) + B\left(y - b \right) +  C\left(z - b \right)\)
</p>

<p>
Distributing and collecting constants:
\(A\left(x - a \right) + B\left(y - b \right) +  C\left(z - b \right) = Ax + By + Cz - \left(Aa + Bb + Cc \right) = 0\)
</p>

<p>
Rewriting the constant values as a new constant \(d\): let $d = Aa + Bb + Cc$$
\(\implies Ax + By + Cz = d\)
</p>

<p>
It's probably overkill at this point, but if you're still not convinced this is a plane, think about the <a href="https://www.desmos.com/calculator/znsfjtqcds">reduced version in 2D</a>, \(By+Cx = \tilde{d}\).
This is just a line - for some \(x\), there's some \(y\), extending into 3D is no different.
</p>
</div>
</div>

<div id="outline-container-org32ecf65" class="outline-2">
<h2 id="org32ecf65">Ray Plane Intersection</h2>
<div class="outline-text-2" id="text-org32ecf65">
<hr />
<p>
Finding the necessary distance a given ray (that is to say a given direction \(\vec{rd}\)) should travel to intersect with a plane is pretty straight forward.
If you're interested in this kind of stuff and unitiated, see this <a href="../../Graphics/ray_sphere_intersection/index.html">introduction I wrote</a>.
</p>

<p>
<b>Ray:</b> \(\vec{ro} + t\vec{rd}\)
</p>

<p>
<b>Equation for Plane</b>  \(\left( \vec{P^{\prime}} - \vec{P} \right) \cdot \vec{n} = 0\)
</p>

<p>
Substituting the intersecting point on the plane \(\vec{P^{\prime}}\) for the rays position vector:
</p>

<p>
\(\left( \left( \vec{ro} + t\vec{rd} \right) - \vec{P} \right) \cdot \vec{n} = 0\)
</p>

<p>
By properties of dot products: 
\[\implies \vec{ro} \cdot \vec{n} + t \vec{rd} \cdot \vec{n} - \vec{P} \cdot \vec{n} = 0\]
</p>

<p>
Remembering that \(\vec{P} \cdot \vec{n}\) is the distance from the origin to the plane:
\[\implies \vec{ro} \cdot \vec{n} + t \vec{rd} \cdot \vec{n} - d = 0\]
(Notice how similar this is to the original expression from the video, a small sleight of hand in my opinion)
\[\implies t = \frac{d - \vec{ro} \cdot \vec{n}}{\vec{rd} \cdot \vec{n}}\]
</p>

<p>
Rational functions are discontinuous with a zero denominator; \(\vec{rd} \cdot \vec{n} = 0\)
</p>

<p>
Again by dot product properties, this implies that \(\vec{n}\) and \(\vec{rd}\) are orthogonal to each other, or the ray direction is parallel to the plane
So the equation seems to make physical sense.
</p>
</div>
</div>

<div id="outline-container-org3a9bf3e" class="outline-2">
<h2 id="org3a9bf3e">Wrapping Up</h2>
<div class="outline-text-2" id="text-org3a9bf3e">
<hr />

<p>
This was kind of a dumb derivation. I started writing it because it was wrong to say that the first expression
\(\hat{n} \cdot \vec{P} + d = 0\) is the equation of a plane.
It's really a kind of sleight of hand/ accident (sign error?) that the video gets
the <b>t</b> ray-intersection scalar out of their equation.
Planes and Ray-Plane intersections are basic concepts, but it's (always?) good to refresh fundamentals.
If nothing else, it hopefully fits the handmade ethos.
</p>

<p>
I wish programming culture used more standard math notation &amp; was more explicit in derivations / language, but I'm sure programmers
are even more annoyed whenever they're forced to see scientists' unfortunate Matlab/ Python / Julia / R code.
</p>
</div>

<div id="outline-container-org9ccdfcc" class="outline-3">
<h3 id="org9ccdfcc">Misc.</h3>
<div class="outline-text-3" id="text-org9ccdfcc">
<hr />
<p>
Here's a <a href="http://lousodrome.net/blog/light/2020/07/03/intersection-of-a-ray-and-a-plane/">less verbose article</a> from a graphics programmer I like.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.2 (<a href="https://orgmode.org">Org</a> mode 9.4.4)</p>
</div>
</main>
  <footer>
      <p>©Ian Stranathan 2022</p> 
  <footer>
</body>